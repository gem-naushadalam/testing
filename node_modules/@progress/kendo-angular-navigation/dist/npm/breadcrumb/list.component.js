/**-----------------------------------------------------------------------------------------
* Copyright © 2020 Progress Software Corporation. All rights reserved.
* Licensed under commercial license. See LICENSE.md in the project root for more information
*-------------------------------------------------------------------------------------------*/
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var core_1 = require("@angular/core");
var rxjs_1 = require("rxjs");
var operators_1 = require("rxjs/operators");
var kendo_angular_common_1 = require("@progress/kendo-angular-common");
var constants_1 = require("./models/constants");
var breadcrumb_item_component_1 = require("./breadcrumb-item.component");
var dom_queries_1 = require("../common/dom-queries");
var util_1 = require("../common/util");
/**
 * @hidden
 */
var ɵngcc0 = require('@angular/core');
var ɵngcc1 = require('@angular/common');
var ɵngcc2 = require('./breadcrumb-item.component');
var ɵngcc3 = require('./template-directives/separator.directive');

var _c0 = ["kendoBreadCrumbList", ""];
function BreadCrumbListComponent_ng_container_0_li_1_span_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "span", 5);
} if (rf & 2) {
    var ctx_r7 = ɵngcc0.ɵɵnextContext(3);
    ɵngcc0.ɵɵproperty("icon", ctx_r7.separatorIcon);
} }
function BreadCrumbListComponent_ng_container_0_li_1_span_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "span", 5);
} if (rf & 2) {
    var ctx_r8 = ɵngcc0.ɵɵnextContext(3);
    ɵngcc0.ɵɵproperty("icon", ctx_r8.separatorIcon);
} }
function BreadCrumbListComponent_ng_container_0_li_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "li", 2, 3);
    ɵngcc0.ɵɵtemplate(2, BreadCrumbListComponent_ng_container_0_li_1_span_2_Template, 1, 1, "span", 4);
    ɵngcc0.ɵɵtemplate(3, BreadCrumbListComponent_ng_container_0_li_1_span_3_Template, 1, 1, "span", 4);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var ctx_r9 = ɵngcc0.ɵɵnextContext();
    var item_r1 = ctx_r9.$implicit;
    var i_r2 = ctx_r9.index;
    var isFirst_r3 = ctx_r9.first;
    var isLast_r4 = ctx_r9.last;
    var ctx_r5 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("item", item_r1)("index", i_r2)("collapseMode", ctx_r5.collapseMode)("itemTemplate", ctx_r5.itemTemplate);
    ɵngcc0.ɵɵattribute("data-kendo-breadcrumb-index", i_r2);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r5.collapseMode === "wrap" && !isFirst_r3);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r5.collapseMode !== "wrap" && !isLast_r4 && !((item_r1 == null ? null : item_r1.context.collapsed) && (ctx_r5.items[i_r2 + 1] == null ? null : ctx_r5.items[i_r2 + 1].context.collapsed)));
} }
function BreadCrumbListComponent_ng_container_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtemplate(1, BreadCrumbListComponent_ng_container_0_li_1_Template, 4, 7, "li", 1);
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    var isFirst_r3 = ctx.first;
    var ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", !(ctx_r0.collapseMode === "wrap" && isFirst_r3) || ctx_r0.isRootItemContainer);
} }
var BreadCrumbListComponent = /** @class */ (function () {
    function BreadCrumbListComponent(el, zone) {
        var _this = this;
        this.el = el;
        this.zone = zone;
        this.items = [];
        this.collapseMode = 'auto';
        this.itemClick = new core_1.EventEmitter();
        var element = this.el.nativeElement;
        this.isRootItemContainer = element.classList.contains('k-breadcrumb-root-item-container');
        this.zone.runOutsideAngular(function () {
            var click$ = rxjs_1.fromEvent(element, 'click');
            var enterKey$ = rxjs_1.fromEvent(element, 'keydown').pipe(operators_1.filter(function (ev /* KeyboardEvent causes lint error */) { return ev.keyCode === kendo_angular_common_1.Keys.Enter; }));
            _this.domEventsSubscription = rxjs_1.merge(click$, enterKey$)
                .pipe(operators_1.map(function (ev) { return ev.target; }), operators_1.filter(function (e) { return !e.classList.contains('k-breadcrumb-delimiter-icon'); }), // do not trigger handler when a separator is clicked
            operators_1.map(function (e) { return _this.getItemIndex(e); }), operators_1.filter(util_1.isPresent), operators_1.map(function (i) { return parseInt(i, 10); }), operators_1.map(function (i) { return _this.items[i]; }), operators_1.filter(function (item) { return !item.data.disabled && !item.context.isLast; }), operators_1.map(function (item) { return item.data; }))
                .subscribe(function (el) {
                _this.zone.run(function () { return _this.itemClick.emit(el); });
            });
        });
    }
    BreadCrumbListComponent.prototype.ngOnDestroy = function () {
        this.domEventsSubscription.unsubscribe();
    };
    BreadCrumbListComponent.prototype.getItemIndex = function (target) {
        var item = dom_queries_1.closestItem(target, constants_1.BREADCRUMB_ITEM_INDEX, this.el.nativeElement);
        if (item) {
            return dom_queries_1.itemIndex(item, constants_1.BREADCRUMB_ITEM_INDEX);
        }
    };
    tslib_1.__decorate([
        core_1.Input(),
        tslib_1.__metadata("design:type", Array)
    ], BreadCrumbListComponent.prototype, "items", void 0);
    tslib_1.__decorate([
        core_1.Input(),
        tslib_1.__metadata("design:type", core_1.TemplateRef)
    ], BreadCrumbListComponent.prototype, "itemTemplate", void 0);
    tslib_1.__decorate([
        core_1.Input(),
        tslib_1.__metadata("design:type", String)
    ], BreadCrumbListComponent.prototype, "collapseMode", void 0);
    tslib_1.__decorate([
        core_1.Input(),
        tslib_1.__metadata("design:type", String)
    ], BreadCrumbListComponent.prototype, "separatorIcon", void 0);
    tslib_1.__decorate([
        core_1.Output(),
        tslib_1.__metadata("design:type", core_1.EventEmitter)
    ], BreadCrumbListComponent.prototype, "itemClick", void 0);
    tslib_1.__decorate([
        core_1.ViewChildren(breadcrumb_item_component_1.BreadCrumbItemComponent, { static: true }),
        tslib_1.__metadata("design:type", core_1.QueryList)
    ], BreadCrumbListComponent.prototype, "renderedItems", void 0);
    BreadCrumbListComponent = tslib_1.__decorate([ tslib_1.__metadata("design:paramtypes", [core_1.ElementRef, core_1.NgZone])
    ], BreadCrumbListComponent);
BreadCrumbListComponent.ɵfac = function BreadCrumbListComponent_Factory(t) { return new (t || BreadCrumbListComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone)); };
BreadCrumbListComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: BreadCrumbListComponent, selectors: [["", "kendoBreadCrumbList", ""]], viewQuery: function BreadCrumbListComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(breadcrumb_item_component_1.BreadCrumbItemComponent, 3);
    } if (rf & 2) {
        var _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.renderedItems = _t);
    } }, inputs: { items: "items", collapseMode: "collapseMode", itemTemplate: "itemTemplate", separatorIcon: "separatorIcon" }, outputs: { itemClick: "itemClick" }, attrs: _c0, decls: 1, vars: 1, consts: [[4, "ngFor", "ngForOf"], ["kendoBreadCrumbItem", "", 3, "item", "index", "collapseMode", "itemTemplate", 4, "ngIf"], ["kendoBreadCrumbItem", "", 3, "item", "index", "collapseMode", "itemTemplate"], ["renderedItem", ""], ["kendoBreadCrumbSeparator", "", 3, "icon", 4, "ngIf"], ["kendoBreadCrumbSeparator", "", 3, "icon"]], template: function BreadCrumbListComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵtemplate(0, BreadCrumbListComponent_ng_container_0_Template, 2, 1, "ng-container", 0);
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("ngForOf", ctx.items);
    } }, directives: [ɵngcc1.NgForOf, ɵngcc1.NgIf, ɵngcc2.BreadCrumbItemComponent, ɵngcc3.BreadCrumbSeparatorDirective], encapsulation: 2 });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(BreadCrumbListComponent, [{
        type: core_1.Component,
        args: [{
                selector: '[kendoBreadCrumbList]',
                template: "\n        <ng-container *ngFor=\"let item of items; let i = index; let isFirst = first; let isLast = last\">\n            <li\n                #renderedItem\n                kendoBreadCrumbItem\n                *ngIf=\"!(collapseMode === 'wrap' && isFirst) || isRootItemContainer\"\n                [attr." + constants_1.BREADCRUMB_ITEM_INDEX + "]=\"i\"\n                [item]=\"item\"\n                [index]=\"i\"\n                [collapseMode]=\"collapseMode\"\n                [itemTemplate]=\"itemTemplate\"\n            >\n                <span kendoBreadCrumbSeparator [icon]=\"separatorIcon\" *ngIf=\"collapseMode === 'wrap' && !isFirst\"></span>\n                <span\n                    kendoBreadCrumbSeparator\n                    [icon]=\"separatorIcon\"\n                    *ngIf=\"collapseMode !== 'wrap' && !isLast && !(item?.context.collapsed && items[i + 1]?.context.collapsed)\"\n                ></span>\n            </li>\n        </ng-container>\n    "
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc0.NgZone }]; }, { items: [{
            type: core_1.Input
        }], collapseMode: [{
            type: core_1.Input
        }], itemClick: [{
            type: core_1.Output
        }], itemTemplate: [{
            type: core_1.Input
        }], separatorIcon: [{
            type: core_1.Input
        }], renderedItems: [{
            type: core_1.ViewChildren,
            args: [breadcrumb_item_component_1.BreadCrumbItemComponent, { static: true }]
        }] }); })();
    return BreadCrumbListComponent;
}());
exports.BreadCrumbListComponent = BreadCrumbListComponent;

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlzdC5jb21wb25lbnQuanMiLCJzb3VyY2VzIjpbImxpc3QuY29tcG9uZW50LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0RBS087QUFDUDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFBZ0M7QUFDaEM7QUFDQTtBQUNBIiwic291cmNlc0NvbnRlbnQiOlsiLyoqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiogQ29weXJpZ2h0IMKpIDIwMjAgUHJvZ3Jlc3MgU29mdHdhcmUgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4qIExpY2Vuc2VkIHVuZGVyIGNvbW1lcmNpYWwgbGljZW5zZS4gU2VlIExJQ0VOU0UubWQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbW9yZSBpbmZvcm1hdGlvblxuKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgdHNsaWJfMSA9IHJlcXVpcmUoXCJ0c2xpYlwiKTtcbnZhciBjb3JlXzEgPSByZXF1aXJlKFwiQGFuZ3VsYXIvY29yZVwiKTtcbnZhciByeGpzXzEgPSByZXF1aXJlKFwicnhqc1wiKTtcbnZhciBvcGVyYXRvcnNfMSA9IHJlcXVpcmUoXCJyeGpzL29wZXJhdG9yc1wiKTtcbnZhciBrZW5kb19hbmd1bGFyX2NvbW1vbl8xID0gcmVxdWlyZShcIkBwcm9ncmVzcy9rZW5kby1hbmd1bGFyLWNvbW1vblwiKTtcbnZhciBjb25zdGFudHNfMSA9IHJlcXVpcmUoXCIuL21vZGVscy9jb25zdGFudHNcIik7XG52YXIgYnJlYWRjcnVtYl9pdGVtX2NvbXBvbmVudF8xID0gcmVxdWlyZShcIi4vYnJlYWRjcnVtYi1pdGVtLmNvbXBvbmVudFwiKTtcbnZhciBkb21fcXVlcmllc18xID0gcmVxdWlyZShcIi4uL2NvbW1vbi9kb20tcXVlcmllc1wiKTtcbnZhciB1dGlsXzEgPSByZXF1aXJlKFwiLi4vY29tbW9uL3V0aWxcIik7XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xudmFyIEJyZWFkQ3J1bWJMaXN0Q29tcG9uZW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEJyZWFkQ3J1bWJMaXN0Q29tcG9uZW50KGVsLCB6b25lKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuZWwgPSBlbDtcbiAgICAgICAgdGhpcy56b25lID0gem9uZTtcbiAgICAgICAgdGhpcy5pdGVtcyA9IFtdO1xuICAgICAgICB0aGlzLmNvbGxhcHNlTW9kZSA9ICdhdXRvJztcbiAgICAgICAgdGhpcy5pdGVtQ2xpY2sgPSBuZXcgY29yZV8xLkV2ZW50RW1pdHRlcigpO1xuICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWwubmF0aXZlRWxlbWVudDtcbiAgICAgICAgdGhpcy5pc1Jvb3RJdGVtQ29udGFpbmVyID0gZWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoJ2stYnJlYWRjcnVtYi1yb290LWl0ZW0tY29udGFpbmVyJyk7XG4gICAgICAgIHRoaXMuem9uZS5ydW5PdXRzaWRlQW5ndWxhcihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgY2xpY2skID0gcnhqc18xLmZyb21FdmVudChlbGVtZW50LCAnY2xpY2snKTtcbiAgICAgICAgICAgIHZhciBlbnRlcktleSQgPSByeGpzXzEuZnJvbUV2ZW50KGVsZW1lbnQsICdrZXlkb3duJykucGlwZShvcGVyYXRvcnNfMS5maWx0ZXIoZnVuY3Rpb24gKGV2IC8qIEtleWJvYXJkRXZlbnQgY2F1c2VzIGxpbnQgZXJyb3IgKi8pIHsgcmV0dXJuIGV2LmtleUNvZGUgPT09IGtlbmRvX2FuZ3VsYXJfY29tbW9uXzEuS2V5cy5FbnRlcjsgfSkpO1xuICAgICAgICAgICAgX3RoaXMuZG9tRXZlbnRzU3Vic2NyaXB0aW9uID0gcnhqc18xLm1lcmdlKGNsaWNrJCwgZW50ZXJLZXkkKVxuICAgICAgICAgICAgICAgIC5waXBlKG9wZXJhdG9yc18xLm1hcChmdW5jdGlvbiAoZXYpIHsgcmV0dXJuIGV2LnRhcmdldDsgfSksIG9wZXJhdG9yc18xLmZpbHRlcihmdW5jdGlvbiAoZSkgeyByZXR1cm4gIWUuY2xhc3NMaXN0LmNvbnRhaW5zKCdrLWJyZWFkY3J1bWItZGVsaW1pdGVyLWljb24nKTsgfSksIC8vIGRvIG5vdCB0cmlnZ2VyIGhhbmRsZXIgd2hlbiBhIHNlcGFyYXRvciBpcyBjbGlja2VkXG4gICAgICAgICAgICBvcGVyYXRvcnNfMS5tYXAoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIF90aGlzLmdldEl0ZW1JbmRleChlKTsgfSksIG9wZXJhdG9yc18xLmZpbHRlcih1dGlsXzEuaXNQcmVzZW50KSwgb3BlcmF0b3JzXzEubWFwKGZ1bmN0aW9uIChpKSB7IHJldHVybiBwYXJzZUludChpLCAxMCk7IH0pLCBvcGVyYXRvcnNfMS5tYXAoZnVuY3Rpb24gKGkpIHsgcmV0dXJuIF90aGlzLml0ZW1zW2ldOyB9KSwgb3BlcmF0b3JzXzEuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7IHJldHVybiAhaXRlbS5kYXRhLmRpc2FibGVkICYmICFpdGVtLmNvbnRleHQuaXNMYXN0OyB9KSwgb3BlcmF0b3JzXzEubWFwKGZ1bmN0aW9uIChpdGVtKSB7IHJldHVybiBpdGVtLmRhdGE7IH0pKVxuICAgICAgICAgICAgICAgIC5zdWJzY3JpYmUoZnVuY3Rpb24gKGVsKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuem9uZS5ydW4oZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuaXRlbUNsaWNrLmVtaXQoZWwpOyB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgQnJlYWRDcnVtYkxpc3RDb21wb25lbnQucHJvdG90eXBlLm5nT25EZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmRvbUV2ZW50c1N1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgIH07XG4gICAgQnJlYWRDcnVtYkxpc3RDb21wb25lbnQucHJvdG90eXBlLmdldEl0ZW1JbmRleCA9IGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICAgICAgdmFyIGl0ZW0gPSBkb21fcXVlcmllc18xLmNsb3Nlc3RJdGVtKHRhcmdldCwgY29uc3RhbnRzXzEuQlJFQURDUlVNQl9JVEVNX0lOREVYLCB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQpO1xuICAgICAgICBpZiAoaXRlbSkge1xuICAgICAgICAgICAgcmV0dXJuIGRvbV9xdWVyaWVzXzEuaXRlbUluZGV4KGl0ZW0sIGNvbnN0YW50c18xLkJSRUFEQ1JVTUJfSVRFTV9JTkRFWCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHRzbGliXzEuX19kZWNvcmF0ZShbXG4gICAgICAgIGNvcmVfMS5JbnB1dCgpLFxuICAgICAgICB0c2xpYl8xLl9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBBcnJheSlcbiAgICBdLCBCcmVhZENydW1iTGlzdENvbXBvbmVudC5wcm90b3R5cGUsIFwiaXRlbXNcIiwgdm9pZCAwKTtcbiAgICB0c2xpYl8xLl9fZGVjb3JhdGUoW1xuICAgICAgICBjb3JlXzEuSW5wdXQoKSxcbiAgICAgICAgdHNsaWJfMS5fX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgY29yZV8xLlRlbXBsYXRlUmVmKVxuICAgIF0sIEJyZWFkQ3J1bWJMaXN0Q29tcG9uZW50LnByb3RvdHlwZSwgXCJpdGVtVGVtcGxhdGVcIiwgdm9pZCAwKTtcbiAgICB0c2xpYl8xLl9fZGVjb3JhdGUoW1xuICAgICAgICBjb3JlXzEuSW5wdXQoKSxcbiAgICAgICAgdHNsaWJfMS5fX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgU3RyaW5nKVxuICAgIF0sIEJyZWFkQ3J1bWJMaXN0Q29tcG9uZW50LnByb3RvdHlwZSwgXCJjb2xsYXBzZU1vZGVcIiwgdm9pZCAwKTtcbiAgICB0c2xpYl8xLl9fZGVjb3JhdGUoW1xuICAgICAgICBjb3JlXzEuSW5wdXQoKSxcbiAgICAgICAgdHNsaWJfMS5fX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgU3RyaW5nKVxuICAgIF0sIEJyZWFkQ3J1bWJMaXN0Q29tcG9uZW50LnByb3RvdHlwZSwgXCJzZXBhcmF0b3JJY29uXCIsIHZvaWQgMCk7XG4gICAgdHNsaWJfMS5fX2RlY29yYXRlKFtcbiAgICAgICAgY29yZV8xLk91dHB1dCgpLFxuICAgICAgICB0c2xpYl8xLl9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBjb3JlXzEuRXZlbnRFbWl0dGVyKVxuICAgIF0sIEJyZWFkQ3J1bWJMaXN0Q29tcG9uZW50LnByb3RvdHlwZSwgXCJpdGVtQ2xpY2tcIiwgdm9pZCAwKTtcbiAgICB0c2xpYl8xLl9fZGVjb3JhdGUoW1xuICAgICAgICBjb3JlXzEuVmlld0NoaWxkcmVuKGJyZWFkY3J1bWJfaXRlbV9jb21wb25lbnRfMS5CcmVhZENydW1iSXRlbUNvbXBvbmVudCwgeyBzdGF0aWM6IHRydWUgfSksXG4gICAgICAgIHRzbGliXzEuX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIGNvcmVfMS5RdWVyeUxpc3QpXG4gICAgXSwgQnJlYWRDcnVtYkxpc3RDb21wb25lbnQucHJvdG90eXBlLCBcInJlbmRlcmVkSXRlbXNcIiwgdm9pZCAwKTtcbiAgICBCcmVhZENydW1iTGlzdENvbXBvbmVudCA9IHRzbGliXzEuX19kZWNvcmF0ZShbXG4gICAgICAgIGNvcmVfMS5Db21wb25lbnQoe1xuICAgICAgICAgICAgc2VsZWN0b3I6ICdba2VuZG9CcmVhZENydW1iTGlzdF0nLFxuICAgICAgICAgICAgdGVtcGxhdGU6IFwiXFxuICAgICAgICA8bmctY29udGFpbmVyICpuZ0Zvcj1cXFwibGV0IGl0ZW0gb2YgaXRlbXM7IGxldCBpID0gaW5kZXg7IGxldCBpc0ZpcnN0ID0gZmlyc3Q7IGxldCBpc0xhc3QgPSBsYXN0XFxcIj5cXG4gICAgICAgICAgICA8bGlcXG4gICAgICAgICAgICAgICAgI3JlbmRlcmVkSXRlbVxcbiAgICAgICAgICAgICAgICBrZW5kb0JyZWFkQ3J1bWJJdGVtXFxuICAgICAgICAgICAgICAgICpuZ0lmPVxcXCIhKGNvbGxhcHNlTW9kZSA9PT0gJ3dyYXAnICYmIGlzRmlyc3QpIHx8IGlzUm9vdEl0ZW1Db250YWluZXJcXFwiXFxuICAgICAgICAgICAgICAgIFthdHRyLlwiICsgY29uc3RhbnRzXzEuQlJFQURDUlVNQl9JVEVNX0lOREVYICsgXCJdPVxcXCJpXFxcIlxcbiAgICAgICAgICAgICAgICBbaXRlbV09XFxcIml0ZW1cXFwiXFxuICAgICAgICAgICAgICAgIFtpbmRleF09XFxcImlcXFwiXFxuICAgICAgICAgICAgICAgIFtjb2xsYXBzZU1vZGVdPVxcXCJjb2xsYXBzZU1vZGVcXFwiXFxuICAgICAgICAgICAgICAgIFtpdGVtVGVtcGxhdGVdPVxcXCJpdGVtVGVtcGxhdGVcXFwiXFxuICAgICAgICAgICAgPlxcbiAgICAgICAgICAgICAgICA8c3BhbiBrZW5kb0JyZWFkQ3J1bWJTZXBhcmF0b3IgW2ljb25dPVxcXCJzZXBhcmF0b3JJY29uXFxcIiAqbmdJZj1cXFwiY29sbGFwc2VNb2RlID09PSAnd3JhcCcgJiYgIWlzRmlyc3RcXFwiPjwvc3Bhbj5cXG4gICAgICAgICAgICAgICAgPHNwYW5cXG4gICAgICAgICAgICAgICAgICAgIGtlbmRvQnJlYWRDcnVtYlNlcGFyYXRvclxcbiAgICAgICAgICAgICAgICAgICAgW2ljb25dPVxcXCJzZXBhcmF0b3JJY29uXFxcIlxcbiAgICAgICAgICAgICAgICAgICAgKm5nSWY9XFxcImNvbGxhcHNlTW9kZSAhPT0gJ3dyYXAnICYmICFpc0xhc3QgJiYgIShpdGVtPy5jb250ZXh0LmNvbGxhcHNlZCAmJiBpdGVtc1tpICsgMV0/LmNvbnRleHQuY29sbGFwc2VkKVxcXCJcXG4gICAgICAgICAgICAgICAgPjwvc3Bhbj5cXG4gICAgICAgICAgICA8L2xpPlxcbiAgICAgICAgPC9uZy1jb250YWluZXI+XFxuICAgIFwiXG4gICAgICAgIH0pLFxuICAgICAgICB0c2xpYl8xLl9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbY29yZV8xLkVsZW1lbnRSZWYsIGNvcmVfMS5OZ1pvbmVdKVxuICAgIF0sIEJyZWFkQ3J1bWJMaXN0Q29tcG9uZW50KTtcbiAgICByZXR1cm4gQnJlYWRDcnVtYkxpc3RDb21wb25lbnQ7XG59KCkpO1xuZXhwb3J0cy5CcmVhZENydW1iTGlzdENvbXBvbmVudCA9IEJyZWFkQ3J1bWJMaXN0Q29tcG9uZW50O1xuIl19